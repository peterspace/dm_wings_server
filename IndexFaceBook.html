<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Purchase</title>
  <script>
    // Load Facebook Pixel base code
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '695851359343051'); // Replace 'YOUR_PIXEL_ID' with your actual Pixel ID
    fbq('track', 'PageView');

    // Function to trigger the purchase event
    function trackPurchase(purchaseData) {
      fbq('track', 'Purchase', {
        value: purchaseData.value,
        currency: purchaseData.currency
      });
    }

    // Function to fetch purchase information from the server
    async function getPurchaseInfo() {
      try {
        const response = await fetch('/get_purchase_info'); // Endpoint to fetch purchase information
        const purchaseData = await response.json();
        console.log('Purchase Data:', purchaseData);

        // Trigger Facebook Pixel purchase event
        trackPurchase(purchaseData);

        // Send purchase event to server
        await fetch('/create_facebook_purchase_event', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(purchaseData)
        });
      } catch (error) {
        console.error('Error fetching purchase information:', error);
      }
    }

    // Call the function to get purchase information and track the event
    document.addEventListener('DOMContentLoaded', getPurchaseInfo);
  </script>
</head>
<body>
  <h1>Track Purchase</h1>
</body>
</html>
