<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Events</title>
  <script>
    // Load Facebook Pixel base code
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '695851359343051'); // Replace 'YOUR_PIXEL_ID' with your actual Pixel ID
    fbq('track', 'PageView');

    // Function to trigger events
    function trackEvent(eventName, eventData) {
      fbq('track', eventName, eventData);
    }

    // Function to fetch event information from the server
    async function getEventInfo(eventType) {
      try {
        const response = await fetch(`/get_${eventType}_info`); // Endpoint to fetch event information
        const eventData = await response.json();
        console.log(`${eventType.charAt(0).toUpperCase() + eventType.slice(1)} Data:`, eventData);

        // Trigger Facebook Pixel event
        console.log(`${eventType.charAt(0).toUpperCase() + eventType.slice(1)} Data:`, eventData);
        trackEvent(eventType.charAt(0).toUpperCase() + eventType.slice(1), eventData);

        // Send event data to server
        await fetch(`/create_facebook_${eventType}_event`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(eventData)
        });
      } catch (error) {
        console.error(`Error fetching ${eventType} information:`, error);
      }
    }

    // Call the function to get event information and track the event
    document.addEventListener('DOMContentLoaded', () => {
      getEventInfo('purchase');
      getEventInfo('lead');
    });
  </script>
</head>
<body>
  <h1>Track Events</h1>
</body>
</html>
